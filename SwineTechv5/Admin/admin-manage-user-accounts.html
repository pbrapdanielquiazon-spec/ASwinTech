<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SwineTech | Manage Users</title>
  <link rel="stylesheet" href="admin.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    .btn-toggle {
      background: var(--color-primary, #2E3B4E);
      color: #fff; border: none;
      padding: 6px 12px; margin: 4px 0;
      border-radius: 6px; cursor: pointer;
      font-size: 0.9rem;
    }
    .btn-toggle:hover { background: var(--color-accent, #43A047); }
    .btn-restore { background:#29B6F6; color:#fff; border:none; padding:6px 12px; border-radius:5px; cursor:pointer; }
    .btn-restore:hover { background:#0288D1; }
    .modal { display:none; position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:100; }
    .modal-content { background:#fff; margin:5% auto; padding:20px; border-radius:8px; width:500px; max-width:95%; text-align:center; }
    .modal-content button { margin:5px; }
    h2 { margin-top:30px; }
    .filter-box { margin: 15px 0; }

     /* Tabs */
    .tabs { margin: 20px 0; }
    .tab-btn {
      background: #f0f0f0; border: none; padding: 10px 20px;
      cursor: pointer; margin-right: 5px; border-radius: 5px;
    }
    .tab-btn.active { background: #43A047; color: #fff; }
    .record-view { display: none; }
    .record-view.active { display: block; }

    /* Modal */
    .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0;
      width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
    .modal-content {
      background: #fff; margin: 5% auto; padding: 20px; border-radius: 8px;
      width: 500px; max-width: 90%;
    }
    .modal h2 { margin-bottom: 15px; }
    .close { float: right; font-size: 22px; cursor: pointer; }

    /* Forms & Buttons */
    .form-group { margin-bottom: 12px; }
    .form-group label { display: block; margin-bottom: 5px; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;
    }
    .btn-auth { background: #43A047; color: #fff; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; }
    .btn-auth:hover { background: #2e7d32; }
    .btn-add, .btn-edit, .btn-archive, .btn-restore {
      padding: 6px 12px; margin: 2px; border: none; border-radius: 5px; cursor: pointer;
    }
    .btn-add { background: #29B6F6; color: #fff; }
    .btn-edit { background: #FFA726; color: #fff; }
    .btn-archive { background: #EF5350; color: #fff; }
    .btn-restore { background: #29B6F6; color: #fff; }
    .filter-box { margin: 10px 0; }
    .admin-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .admin-table th, .admin-table td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .admin-table th { background: #f9f9f9; }
  </style>
</head>
<body>
 <!-- Sidebar -->
 <aside class="sidebar">
    <div class="sidebar-logo">üêñ SwineTech</div>
    <nav>
      <a href="dashboard-admin.html"><i class="fa-solid fa-chart-pie"></i> Admin Dashboard</a>
      <a href="admin-manage-user-accounts.html" class="active"><i class="fa-solid fa-users"></i> Manage User Accounts</a>
      <a href="admin-manage-pig-records.html"><i class="fa-solid fa-piggy-bank"></i> Manage Pig Records</a>
      <a href="admin-manage-feeding-schedule.html"><i class="fa-solid fa-bowl-food"></i> Feeding & Schedule</a>
      <a href="admin-manage-supplies.html"><i class="fa-solid fa-boxes-stacked"></i> Supplies</a>
      <a href="admin-manage-sales-expenses-bookings.html"><i class="fa-solid fa-money-bill-trend-up"></i> Sales & Expenses</a>
      <a href="admin-manage-client-feedback-admin.html"><i class="fa-solid fa-comment-dots"></i> Client Feedback</a>
      <a href="inquiries.html"><i class="fa-solid fa-envelope"></i> Inquiries</a>
      <a href="admin-generate-reports.html"><i class="fa-solid fa-file-lines"></i> Reports</a>
      <a href="logout.php" class="btn-logout"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="dashboard">
    <h1>Manage Users</h1>
    <button class="btn-add" onclick="openAddModal()">+ Add New User</button>

    <!-- Filter -->
    <div class="filter-box">
      <label for="userFilter"><strong>Show:</strong></label>
      <select id="userFilter" onchange="applyFilter()">
        <option value="both">Active & Archived</option>
        <option value="active">Active Only</option>
        <option value="archived">Archived Only</option>
      </select>
    </div>

    <!-- Active Users -->
    <h2 id="activeTitle">Active Users</h2>
    <table class="admin-table" id="activeTableSection">
      <thead>
        <tr>
          <th>ID</th><th>Full Name</th><th>Username</th><th>Email</th>
          <th>Role</th><th>Status</th><th>Profile Picture</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="userTable">
        <tr>
          <td>1</td>
          <td>Juan Dela Cruz</td>
          <td>juandelacruz</td>
          <td>juan@email.com</td>
          <td>Sales</td>
          <td>Active</td>
          <td><img src="download.jpg" alt="Profile" width="40"></td>
          <td>
            <button class="btn-edit" onclick="openEditModal(this)">Edit</button>
            <button class="btn-archive" onclick="confirmArchive(this)">Archive</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Archived Users -->
    <h2 id="archivedTitle">Archived Users</h2>
    <table class="admin-table" id="archivedTableSection">
      <thead>
        <tr>
          <th>ID</th><th>Full Name</th><th>Username</th><th>Email</th>
          <th>Role</th><th>Status</th><th>Profile Picture</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="archivedTable">
        <!-- Archived users will appear here -->
      </tbody>
    </table>
  </main>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeEditModal()">&times;</span>
      <h2>Edit User</h2>
      <form id="editForm">
        <input type="hidden" id="editRowIndex">
        <div class="form-group">
          <button type="button" class="btn-toggle" onclick="enableField('edit_fullname')">Update Name</button>
          <input type="text" id="edit_fullname" name="fullname" disabled>
        </div>
        <div class="form-group">
          <label>Username (locked)</label>
          <input type="text" id="edit_username" name="username" readonly>
        </div>
        <div class="form-group">
          <button type="button" class="btn-toggle" onclick="enableField('edit_password')">Update Password</button>
          <input type="password" id="edit_password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" disabled>
        </div>
        <div class="form-group">
          <button type="button" class="btn-toggle" onclick="enableField('edit_email')">Update Email</button>
          <input type="email" id="edit_email" name="email" disabled>
        </div>
        <div class="form-group">
          <label>Role</label>
          <select id="edit_role" name="role">
            <option value="admin">Admin</option>
            <option value="sales">Sales Staff</option>
            <option value="procurement">Procurement Staff</option>
            <option value="caretaker">Caretaker</option>
            <option value="client">Client</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="edit_status" name="status">
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
        <div class="form-group">
          <button type="button" class="btn-toggle" onclick="enableField('edit_picture')">Update Picture</button>
          <input type="file" id="edit_picture" name="profile_picture" accept="image/*" disabled>
        </div>
        <button type="submit" class="btn-auth">Save Changes</button>
      </form>
    </div>
  </div>

  <!-- Add Modal -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeAddModal()">&times;</span>
      <h2>Add User</h2>
      <form id="addForm">
        <div class="form-group"><label>Full Name</label><input type="text" id="add_fullname" required></div>
        <div class="form-group"><label>Username</label><input type="text" id="add_username" required></div>
        <div class="form-group"><label>Password</label><input type="password" id="add_password" required></div>
        <div class="form-group"><label>Email</label><input type="email" id="add_email" required></div>
        <div class="form-group"><label>Role</label>
          <select id="add_role">
            <option value="admin">Admin</option>
            <option value="sales">Sales Staff</option>
            <option value="procurement">Procurement Staff</option>
            <option value="caretaker">Caretaker</option>
            <option value="client">Client</option>
          </select>
        </div>
        <div class="form-group"><label>Status</label>
          <select id="add_status">
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
        <div class="form-group"><label>Profile Picture</label><input type="file" id="add_picture"></div>
        <button type="submit" class="btn-auth">Create User</button>
      </form>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <h3>Are you sure you want to save changes?</h3>
      <button onclick="confirmYes()">Yes</button>
      <button onclick="confirmNo()">Cancel</button>
    </div>
  </div>

  <!-- Archive Confirmation Modal -->
  <div id="archiveModal" class="modal">
    <div class="modal-content">
      <h3>‚ö†Ô∏è Are you sure you want to archive this user?</h3>
      <button onclick="archiveYes()">Yes, Archive</button>
      <button onclick="archiveNo()">Cancel</button>
    </div>
  </div>

  <!-- Success Modal -->
  <div id="successMessage" class="modal">
    <div class="modal-content">
      <h3 id="successText">‚úÖ User updated successfully!</h3>
      <button onclick="closeSuccess()">OK</button>
    </div>
  </div>

<script>
  let pendingAction = null;
  let editTargetRow = null;
  let archiveTargetRow = null;
  let tempImageData = null;

  function openEditModal(btn){
    let row = btn.closest("tr");
    editTargetRow = row;
    document.getElementById("edit_fullname").value = row.cells[1].innerText;
    document.getElementById("edit_username").value = row.cells[2].innerText;
    document.getElementById("edit_email").value = row.cells[3].innerText;
    document.getElementById("edit_role").value = row.cells[4].innerText.toLowerCase();
    document.getElementById("edit_status").value = row.cells[5].innerText.toLowerCase();

    ["edit_fullname","edit_password","edit_email","edit_picture"].forEach(id=>{
      document.getElementById(id).disabled = true;
    });

    tempImageData = null;
    document.getElementById("edit_picture").value = "";
    document.getElementById("editModal").style.display="block";
  }
  function closeEditModal(){ document.getElementById("editModal").style.display="none"; }
  function openAddModal(){ document.getElementById("addModal").style.display="block"; tempImageData=null; document.getElementById("add_picture").value=""; }
  function closeAddModal(){ document.getElementById("addModal").style.display="none"; }
  function enableField(id){ document.getElementById(id).disabled = false; document.getElementById(id).focus(); }

  // Archive
  function confirmArchive(btn){ archiveTargetRow = btn.closest("tr"); document.getElementById("archiveModal").style.display="block"; }
  function archiveYes(){ 
    if(archiveTargetRow){ 
      let archivedTable = document.getElementById("archivedTable");
      archivedTable.appendChild(archiveTargetRow);
      archiveTargetRow.querySelector(".btn-archive").remove();
      let restoreBtn = document.createElement("button");
      restoreBtn.className = "btn-restore";
      restoreBtn.innerText = "Restore";
      restoreBtn.onclick = function(){ restoreUser(this); };
      archiveTargetRow.querySelector("td:last-child").appendChild(restoreBtn);
      showSuccess("‚úÖ User archived successfully!");
    }
    document.getElementById("archiveModal").style.display="none"; 
  }
  function archiveNo(){ document.getElementById("archiveModal").style.display="none"; }

  function restoreUser(btn){
    let row = btn.closest("tr");
    document.getElementById("userTable").appendChild(row);
    btn.remove();
    let archiveBtn = document.createElement("button");
    archiveBtn.className = "btn-archive";
    archiveBtn.innerText = "Archive";
    archiveBtn.onclick = function(){ confirmArchive(this); };
    row.querySelector("td:last-child").appendChild(archiveBtn);
    showSuccess("‚úÖ User restored successfully!");
  }

  // Submit handlers
  document.getElementById("editForm").addEventListener("submit", function(e){
    e.preventDefault();
    pendingAction = "edit";
    document.getElementById("confirmModal").style.display="block";
  });
  document.getElementById("addForm").addEventListener("submit", function(e){
    e.preventDefault();
    pendingAction = "add";
    document.getElementById("confirmModal").style.display="block";
  });

  function confirmYes(){
    document.getElementById("confirmModal").style.display="none";
    if(pendingAction === "edit"){ applyEdit(); closeEditModal(); showSuccess("‚úÖ User updated successfully!"); }
    if(pendingAction === "add"){ applyAdd(); closeAddModal(); showSuccess("‚úÖ User added successfully!"); }
  }
  function confirmNo(){ document.getElementById("confirmModal").style.display="none"; }

  function showSuccess(msg){
    document.getElementById("successText").innerText = msg;
    document.getElementById("successMessage").style.display="block";
  }
  function closeSuccess(){ document.getElementById("successMessage").style.display="none"; }

  function applyEdit(){
    if(!editTargetRow) return;
    editTargetRow.cells[1].innerText = document.getElementById("edit_fullname").value;
    editTargetRow.cells[3].innerText = document.getElementById("edit_email").value;
    editTargetRow.cells[4].innerText = document.getElementById("edit_role").value;
    editTargetRow.cells[5].innerText = document.getElementById("edit_status").value;
    if(tempImageData){ editTargetRow.cells[6].innerHTML = `<img src="${tempImageData}" width="40">`; }
  }

  function applyAdd(){
    let table = document.getElementById("userTable");
    let row = table.insertRow();
    let id = table.rows.length;
    let imgHTML = tempImageData ? `<img src="${tempImageData}" width="40">` : `<img src="download.jpg" width="40">`;
    row.innerHTML = `
      <td>${id}</td>
      <td>${document.getElementById("add_fullname").value}</td>
      <td>${document.getElementById("add_username").value}</td>
      <td>${document.getElementById("add_email").value}</td>
      <td>${document.getElementById("add_role").value}</td>
      <td>${document.getElementById("add_status").value}</td>
      <td>${imgHTML}</td>
      <td>
        <button class="btn-edit" onclick="openEditModal(this)">Edit</button>
        <button class="btn-archive" onclick="confirmArchive(this)">Archive</button>
      </td>
    `;
  }

  // üîπ Apply Filter
  function applyFilter(){
    let filter = document.getElementById("userFilter").value;
    let activeSec = document.getElementById("activeTableSection");
    let activeTitle = document.getElementById("activeTitle");
    let archivedSec = document.getElementById("archivedTableSection");
    let archivedTitle = document.getElementById("archivedTitle");

    if(filter === "active"){
      activeSec.style.display = "";
      activeTitle.style.display = "";
      archivedSec.style.display = "none";
      archivedTitle.style.display = "none";
    } else if(filter === "archived"){
      activeSec.style.display = "none";
      activeTitle.style.display = "none";
      archivedSec.style.display = "";
      archivedTitle.style.display = "";
    } else {
      activeSec.style.display = "";
      activeTitle.style.display = "";
      archivedSec.style.display = "";
      archivedTitle.style.display = "";
    }
  }
</script>
</body>
</html>
